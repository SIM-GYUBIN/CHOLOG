<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>CHOLOG Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --success-color: #4CAF50;
            --warning-color: #ff9914;
            --danger-color: #ef476f;
            --info-color: #4cc9f0;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --gray-color: #6c757d;
            --border-color: #dee2e6;
        }

        body { 
            font-family: 'Noto Sans KR', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 20px; 
            font-size: 14px; 
            line-height: 1.5;
            color: var(--dark-color);
            background-color: #f5f7f9;
        }
        
        h1 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-weight: 700;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }
        
        table { width: 100%; border-collapse: collapse; table-layout: fixed; margin-top: 10px; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        th, td { border: 1px solid var(--border-color); padding: 12px; text-align: left; word-wrap: break-word; }
        th { background-color: var(--primary-color); color: white; font-weight: 600; }
        tr:nth-child(even) { background-color: #f2f5f9; }
        tr:hover { background-color: #e9f0fd; }
        
        .level-INFO { color: var(--info-color); font-weight: 500; }
        .level-WARN { color: var(--warning-color); font-weight: bold; }
        .level-ERROR { color: var(--danger-color); font-weight: bold; }
        .level-DEBUG { color: var(--gray-color); }
        .level-TRACE { color: #aaa; }
        
        .error-details { color: var(--danger-color); font-size: 0.9em; margin-top: 5px; }
        .mdc-details { color: var(--gray-color); font-size: 0.9em; margin-top: 5px; white-space: pre-wrap; }
        
        #logs-container { max-height: 75vh; overflow-y: auto; border-radius: 8px; border: 1px solid var(--border-color); margin-top: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }

        /* ë¡œê·¸ í–‰ í´ë¦­ ê°€ëŠ¥ ìŠ¤íƒ€ì¼ */
        #logs-table tbody tr {
            cursor: pointer;
            transition: all 0.2s;
        }
        #logs-table tbody tr:hover {
            background-color: #e2edff;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        /* í•„í„° ì»¨íŠ¸ë¡¤ ìŠ¤íƒ€ì¼ */
        .filters-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .filter-group {
            display: inline-block;
            margin-right: 15px;
            margin-bottom: 10px;
            vertical-align: top;
        }
        .filter-label {
            font-weight: 500;
            display: block;
            margin-bottom: 8px;
            color: var(--secondary-color);
        }
        select, input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            min-width: 140px;
            transition: all 0.3s;
            font-family: 'Noto Sans KR', sans-serif;
        }
        select:focus, input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s;
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: 500;
        }
        button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        button.reset {
            background-color: var(--danger-color);
        }
        button.reset:hover {
            background-color: #d64161;
        }
        .status-bar {
            margin-top: 10px;
            font-style: italic;
            color: var(--gray-color);
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(3px);
        }
        .modal-content {
            background-color: #fff;
            margin: 2% auto;
            padding: 25px;
            border: 1px solid #888;
            width: 90%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .close-modal {
            color: var(--gray-color);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }
        .close-modal:hover {
            color: var(--dark-color);
        }
        .detail-section {
            margin-bottom: 20px;
            padding: 18px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s;
        }
        .detail-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .detail-section h3 {
            margin-top: 0;
            color: var(--secondary-color);
            font-weight: 600;
        }
        .json-view {
            font-family: 'Consolas', 'Monaco', monospace;
            white-space: pre-wrap;
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
            max-height: 400px;
            overflow-y: auto;
            font-size: 13px;
            line-height: 1.5;
        }
        .tab-container {
            margin-top: 20px;
        }
        .tab {
            overflow: hidden;
            border: 1px solid var(--border-color);
            background-color: #f5f7f9;
            border-radius: 8px 8px 0 0;
        }
        .tab button {
            background-color: transparent;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 12px 20px;
            transition: 0.3s;
            font-size: 14px;
            color: var(--dark-color);
            border-radius: 0;
            margin: 0;
            font-weight: 500;
        }
        .tab button:hover {
            background-color: rgba(67, 97, 238, 0.1);
            transform: none;
            box-shadow: none;
        }
        .tab button.active {
            background-color: var(--primary-color);
            color: white;
        }
        .tabcontent {
            display: none;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 8px 8px;
            animation: fadeIn 0.5s;
            background-color: white;
        }
        .tabcontent.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            margin-bottom: 30px;
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        
        .chart-container:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transform: translateY(-3px);
        }
        
        /* í†µê³„ ìš”ì•½ ì •ë³´ */
        .stats-summary {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stats-card {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 20px;
            flex: 1 1 200px;
            max-width: calc(33% - 20px);
            border-top: 4px solid var(--primary-color);
            transition: all 0.3s;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .stats-card h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
            color: var(--secondary-color);
            font-weight: 600;
        }
        
        .stats-card .value {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark-color);
        }
        
        /* í†µê³„ ë³´ê¸° ë²„íŠ¼ */
        #showStats {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 12px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            z-index: 100;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        #showStats .stats-icon {
            font-size: 18px;
        }
        
        #showStats:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.25);
        }

        /* í†µê³„ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ - í¬ê¸° ì¤„ì„ */
        .stats-modal-content {
            max-width: 1000px;
            width: 80%;
            margin: 3% auto;
            padding: 25px;
            background-color: #f5f7f9;
        }
    </style>
</head>
<body>
<h1>CHOLOG Dashboard</h1>

<!-- í•„í„° ì»¨íŠ¸ë¡¤ -->
<div class="filters-container">
    <div class="filter-group">
        <label class="filter-label" for="apiKey-filter">API í‚¤</label>
        <select id="apiKey-filter">
            <option value="">ì „ì²´</option>
            <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë™ì  ì¶”ê°€ -->
        </select>
    </div>

    <div class="filter-group">
        <label class="filter-label" for="service-filter">ì„œë¹„ìŠ¤</label>
        <select id="service-filter">
            <option value="">ì „ì²´</option>
            <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë™ì  ì¶”ê°€ -->
        </select>
    </div>

    <div class="filter-group">
        <label class="filter-label" for="level-filter">ë¡œê·¸ ë ˆë²¨</label>
        <select id="level-filter">
            <option value="">ì „ì²´</option>
            <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë™ì  ì¶”ê°€ -->
        </select>
    </div>

    <div class="filter-group">
        <label class="filter-label" for="status-filter">HTTP ìƒíƒœ ì½”ë“œ</label>
        <select id="status-filter">
            <option value="">ì „ì²´</option>
            <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë™ì  ì¶”ê°€ -->
        </select>
    </div>

    <div class="filter-group">
        <label class="filter-label" for="path-filter">ê²½ë¡œ (URL)</label>
        <input type="text" id="path-filter" placeholder="ê²½ë¡œ ê²€ìƒ‰...">
    </div>

    <div class="filter-group">
        <label class="filter-label" for="query-filter">ë©”ì‹œì§€ ê²€ìƒ‰</label>
        <input type="text" id="query-filter" placeholder="í‚¤ì›Œë“œ ê²€ìƒ‰...">
    </div>

    <div class="filter-group">
        <label class="filter-label" for="timeRange-filter">ì‹œê°„ ë²”ìœ„</label>
        <select id="timeRange-filter">
            <option value="1h">ìµœê·¼ 1ì‹œê°„</option>
            <option value="6h">ìµœê·¼ 6ì‹œê°„</option>
            <option value="24h" selected>ìµœê·¼ 24ì‹œê°„</option>
            <option value="7d">ìµœê·¼ 7ì¼</option>
            <option value="30d">ìµœê·¼ 30ì¼</option>
        </select>
    </div>

    <div class="filter-group" style="margin-top: 20px;">
        <button id="apply-filters">í•„í„° ì ìš©</button>
        <button id="reset-filters" class="reset">í•„í„° ì´ˆê¸°í™”</button>
    </div>

    <div class="status-bar">
        <span id="log-count">0</span>ê°œì˜ ë¡œê·¸ê°€ í‘œì‹œë¨
    </div>
</div>

<div id="logs-container">
    <table id="logs-table">
        <thead>
        <tr>
            <th style="width: 15%;">Timestamp(KST)</th>
            <th style="width: 7%;">Level</th>
            <th style="width: 15%;">Logger</th>
            <th style="width: 10%;">Service</th>
            <th style="width: 10%;">Request ID</th>
            <th style="width: 43%;">Message & Details</th>
        </tr>
        </thead>
        <tbody><!-- ë¡œê·¸ ë°ì´í„°ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤. --></tbody>
    </table>
</div>

<!-- ë¡œê·¸ ìƒì„¸ ëª¨ë‹¬ -->
<div id="logDetailModal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>ë¡œê·¸ ìƒì„¸ ì •ë³´</h2>

        <div class="tab">
            <button class="tablinks active" onclick="openTab(event, 'formattedView')">í˜•ì‹í™”ëœ ë³´ê¸°</button>
            <button class="tablinks" onclick="openTab(event, 'allFieldsView')">ì›ë³¸ JSON</button>
        </div>

        <div id="formattedView" class="tabcontent active">
            <div class="detail-section">
                <h3>ê¸°ë³¸ ì •ë³´</h3>
                <div id="basicInfo"></div>
            </div>

            <div class="detail-section">
                <h3>ìš”ì²­ ì •ë³´</h3>
                <div id="requestInfo"></div>
            </div>

            <div class="detail-section">
                <h3>ì„±ëŠ¥ ì§€í‘œ</h3>
                <div id="performanceInfo"></div>
            </div>

            <div class="detail-section">
                <h3>MDC ì»¨í…ìŠ¤íŠ¸</h3>
                <div id="mdcInfo"></div>
            </div>

            <div class="detail-section">
                <h3>í—¤ë” ì •ë³´</h3>
                <div id="headersInfo"></div>
            </div>

            <div class="detail-section">
                <h3>ì˜¤ë¥˜ ì •ë³´</h3>
                <div id="errorInfo"></div>
            </div>
        </div>

        <div id="allFieldsView" class="tabcontent">
            <pre id="allFields" class="json-view"></pre>
        </div>
    </div>
</div>

<!-- í†µê³„ ì°¨íŠ¸ ëª¨ë‹¬ -->
<div id="statsModal" class="modal">
    <div class="modal-content stats-modal-content">
        <span class="close-modal" id="closeStatsModal">&times;</span>
        <h2>ë¡œê·¸ í†µê³„ ì‹œê°í™”</h2>
        
        <!-- í†µê³„ ìš”ì•½ ì •ë³´ -->
        <div class="stats-summary">
            <div class="stats-card">
                <h3>ì´ ë¡œê·¸ ìˆ˜</h3>
                <div class="value" id="totalLogs">0</div>
            </div>
            <div class="stats-card">
                <h3>ì—ëŸ¬ ë¡œê·¸ ìˆ˜</h3>
                <div class="value" id="errorLogs">0</div>
            </div>
            <div class="stats-card">
                <h3>í‰ê·  ì‘ë‹µ ì‹œê°„</h3>
                <div class="value" id="avgResponseTime">0ms</div>
            </div>
        </div>
        
        <div class="tab">
            <button class="tablinks active" onclick="openStatsTab(event, 'hourlyChart')">ì‹œê°„ë³„ ë¶„í¬</button>
            <button class="tablinks" onclick="openStatsTab(event, 'levelChart')">ë¡œê·¸ ë ˆë²¨ ë¶„í¬</button>
            <button class="tablinks" onclick="openStatsTab(event, 'statusChart')">ìƒíƒœ ì½”ë“œ ë¶„í¬</button>
        </div>
        
        <div id="hourlyChart" class="tabcontent active">
            <h3>ì‹œê°„ë³„ ë¡œê·¸ ë°œìƒ ê±´ìˆ˜ (KST)</h3>
            <div class="chart-container">
                <canvas id="hourlyDistributionChart"></canvas>
            </div>
        </div>
        
        <div id="levelChart" class="tabcontent">
            <h3>ë¡œê·¸ ë ˆë²¨ ë¶„í¬</h3>
            <div class="chart-container">
                <canvas id="levelDistributionChart"></canvas>
            </div>
        </div>
        
        <div id="statusChart" class="tabcontent">
            <h3>HTTP ìƒíƒœ ì½”ë“œ ë¶„í¬</h3>
            <div class="chart-container">
                <canvas id="statusDistributionChart"></canvas>
            </div>
        </div>
    </div>
</div>

<button id="showStats">
    <span class="stats-icon">ğŸ“Š</span> í†µê³„ ë³´ê¸°
</button>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-gradient"></script>
<script>
    // í˜„ì¬ ë¡œê·¸ ë°ì´í„°ë¥¼ ì €ì¥í•  ë³€ìˆ˜
    let currentLogs = [];
    // ì°¨íŠ¸ ê°ì²´ ì €ì¥
    let hourlyChart = null;
    let levelChart = null;
    let statusChart = null;

    // í•„í„° ìƒíƒœë¥¼ ì €ì¥í•  ê°ì²´
    const filters = {
        apiKey: '',
        path: '',
        level: '',
        status: '',
        service: '',
        query: '',
        timeRange: '24h'
    };

    // ì°¨íŠ¸ í…Œë§ˆ ìƒ‰ìƒ
    const chartColors = {
        primary: '#4361ee',
        secondary: '#3a0ca3',
        success: '#4CAF50',
        warning: '#ff9914',
        danger: '#ef476f',
        info: '#4cc9f0',
        background: '#f5f7f9',
        text: '#212529',
        grid: 'rgba(0, 0, 0, 0.05)',
        hourly: {
            line: '#4361ee',
            fill: 'rgba(67, 97, 238, 0.2)'
        },
        levels: {
            ERROR: '#ef476f',
            WARN: '#ff9914',
            INFO: '#4cc9f0',
            DEBUG: '#6c757d'
        },
        status: {
            '5xx': '#ef476f',
            '4xx': '#ff9914',
            '3xx': '#ffbf69',
            '2xx': '#4CAF50'
        }
    };

    // UTC ì‹œê°„ì„ í•œêµ­ ì‹œê°„(KST)ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
    function convertToKST(utcTimeStr) {
        if (!utcTimeStr) return 'N/A';
        try {
            // UTC ì‹œê°„ì„ Date ê°ì²´ë¡œ ë³€í™˜
            const date = new Date(utcTimeStr);
            
            // í•œêµ­ ì‹œê°„ìœ¼ë¡œ í¬ë§·íŒ… (UTC+9)
            return date.toLocaleString('ko-KR', {
                timeZone: 'Asia/Seoul',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
        } catch (e) {
            console.error('Date conversion error:', e);
            return utcTimeStr; // ë³€í™˜ ì‹¤íŒ¨ ì‹œ ì›ë³¸ ë°˜í™˜
        }
    }

    // UTC ì‹œê°„ì—ì„œ í•œêµ­ ì‹œê°„ì˜ ì‹œê°„(0-23)ì„ ì¶”ì¶œí•˜ëŠ” í•¨ìˆ˜
    function getKSTHour(utcTimeStr) {
        if (!utcTimeStr) return 0;
        try {
            const date = new Date(utcTimeStr);
            // UTC ì‹œê°„ì— 9ì‹œê°„ ì¶”ê°€í•˜ì—¬ KSTë¡œ ë³€í™˜
            const kstHour = (date.getUTCHours() + 9) % 24;
            return kstHour;
        } catch (e) {
            console.error('Hour extraction error:', e);
            return 0;
        }
    }

    // ëª¨ë‹¬ ê´€ë ¨ ìš”ì†Œ
    const modal = document.getElementById("logDetailModal");
    const statsModal = document.getElementById("statsModal");
    const closeModalBtn = document.querySelector(".close-modal");
    const closeStatsModalBtn = document.getElementById("closeStatsModal");
    const showStatsBtn = document.getElementById("showStats");

    // í†µê³„ ëª¨ë‹¬ ì—´ê¸° ë²„íŠ¼
    showStatsBtn.onclick = function() {
        loadChartData();
        statsModal.style.display = "block";
    }

    // í†µê³„ ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
    closeStatsModalBtn.onclick = function() {
        statsModal.style.display = "none";
    }

    // ë‹«ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
    closeModalBtn.onclick = function() {
        modal.style.display = "none";
    }

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
        if (event.target == statsModal) {
            statsModal.style.display = "none";
        }
    }

    // ì°¨íŠ¸ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
    async function loadChartData() {
        try {
            let url = '/stats/charts';
            const params = new URLSearchParams();
            
            if (filters.apiKey) params.append('apiKey', filters.apiKey);
            if (filters.service) params.append('serviceName', filters.service);
            params.append('period', filters.timeRange || '24h');
            
            const queryString = params.toString();
            if (queryString) {
                url += '?' + queryString;
            }
            
            const response = await fetch(url);
            if (!response.ok) {
                console.error('Failed to fetch chart data:', response.statusText);
                return;
            }
            
            const chartData = await response.json();
            
            // í†µê³„ ìš”ì•½ ì •ë³´ ë¡œë“œ
            loadStatsSummary();
            
            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateHourlyChart(chartData.hourlyDistributionChart);
            updateLevelChart(chartData.levelDistributionChart);
            updateStatusChart(chartData.statusDistributionChart);
            
        } catch (error) {
            console.error('Error loading chart data:', error);
        }
    }
    
    // í†µê³„ ìš”ì•½ ì •ë³´ ë¡œë“œ
    async function loadStatsSummary() {
        try {
            let url = '/stats';
            const params = new URLSearchParams();
            
            if (filters.apiKey) params.append('apiKey', filters.apiKey);
            if (filters.service) params.append('serviceName', filters.service);
            params.append('timeRange', filters.timeRange || '24h');
            
            const queryString = params.toString();
            if (queryString) {
                url += '?' + queryString;
            }
            
            const response = await fetch(url);
            if (!response.ok) {
                console.error('Failed to fetch stats summary:', response.statusText);
                return;
            }
            
            const statsData = await response.json();
            
            // ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('totalLogs').textContent = statsData.totalLogs || 0;
            
            // ì—ëŸ¬ ë¡œê·¸ ìˆ˜ ê³„ì‚°
            const levelDist = statsData.levelDistribution || {};
            document.getElementById('errorLogs').textContent = levelDist.ERROR || 0;
            
            // í‰ê·  ì‘ë‹µ ì‹œê°„
            const responseTimeMetrics = statsData.responseTimeMetrics || {};
            const avgTime = responseTimeMetrics.average || 0;
            document.getElementById('avgResponseTime').textContent = 
                avgTime.toFixed(2) + 'ms';
            
        } catch (error) {
            console.error('Error loading stats summary:', error);
        }
    }
    
    // ì‹œê°„ë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
    function updateHourlyChart(data) {
        // í•œêµ­ ì‹œê°„ ë ˆì´ë¸” (0-23ì‹œ)
        const labels = Array.from({length: 24}, (_, i) => `${i}ì‹œ`);
        
        // ë°ì´í„° ë§¤í•‘
        const counts = Array(24).fill(0);
        if (data) {
            data.forEach(item => {
                // UTC ì‹œê°„ì„ KSTë¡œ ë³€í™˜ (ì„œë²„ì—ì„œ ì‹œê°„ì„ ë³€í™˜í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œ ì²˜ë¦¬)
                const kstHour = (item.hour + 9) % 24;
                counts[kstHour] = item.count;
            });
        }
        
        // ì°¨íŠ¸ ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸
        const ctx = document.getElementById('hourlyDistributionChart').getContext('2d');
        
        // ì´ì „ ì°¨íŠ¸ ì‚­ì œ
        if (hourlyChart) {
            hourlyChart.destroy();
        }
        
        // ì„ í˜• ê·¸ë¼ë°ì´ì…˜ ìƒì„±
        const gradient = ctx.createLinearGradient(0, 0, 0, 300);
        gradient.addColorStop(0, 'rgba(67, 97, 238, 0.7)');
        gradient.addColorStop(1, 'rgba(67, 97, 238, 0.05)');
        
        // ìƒˆ ì°¨íŠ¸ ìƒì„± - ë°” ì°¨íŠ¸ì—ì„œ ì„  ê·¸ë˜í”„ë¡œ ë³€ê²½
        hourlyChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'ë¡œê·¸ ìˆ˜',
                    data: counts,
                    borderColor: chartColors.hourly.line,
                    backgroundColor: gradient,
                    pointBackgroundColor: 'white',
                    pointBorderColor: chartColors.primary,
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6,
                    fill: true,
                    tension: 0.3,
                    borderWidth: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: chartColors.grid,
                            drawBorder: false
                        },
                        ticks: {
                            font: {
                                weight: 'bold'
                            },
                            padding: 10,
                            precision: 0,  // ì •ìˆ˜ë§Œ í‘œì‹œí•˜ë„ë¡ ì„¤ì •
                            stepSize: 1    // ëˆˆê¸ˆ ê°„ê²©ì„ 1ë¡œ ì„¤ì •
                        },
                        title: {
                            display: true,
                            text: 'ë¡œê·¸ ê±´ìˆ˜',
                            font: {
                                weight: 'bold',
                                size: 14
                            },
                            padding: {top: 10, bottom: 10}
                        }
                    },
                    x: {
                        grid: {
                            display: false,
                            drawBorder: false
                        },
                        ticks: {
                            font: {
                                weight: 'bold'
                            },
                            padding: 10
                        },
                        title: {
                            display: true,
                            text: 'ì‹œê°„ (KST)',
                            font: {
                                weight: 'bold',
                                size: 14
                            },
                            padding: {top: 10, bottom: 10}
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    title: {
                        display: true,
                        text: 'ì‹œê°„ë³„ ë¡œê·¸ ë¶„í¬ (KST)',
                        font: {
                            size: 16,
                            weight: 'bold'
                        },
                        padding: {top: 10, bottom: 20}
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleFont: {
                            weight: 'bold'
                        },
                        bodyFont: {
                            size: 14
                        },
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                return `${context.raw}ê±´ì˜ ë¡œê·¸`;
                            },
                            labelTextColor: function() {
                                return '#fff';
                            }
                        },
                        padding: 12,
                        cornerRadius: 8
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                animation: {
                    duration: 1500,
                    easing: 'easeOutQuart'
                },
                elements: {
                    line: {
                        borderJoinStyle: 'round'
                    }
                }
            }
        });
    }
    
    // ë¡œê·¸ ë ˆë²¨ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
    function updateLevelChart(data) {
        if (!data || data.length === 0) return;
        
        const labels = data.map(item => item.level);
        const counts = data.map(item => item.count);
        
        // ë¡œê·¸ ë ˆë²¨ì— ë”°ë¥¸ ìƒ‰ìƒ ì§€ì •
        const backgroundColors = labels.map(level => {
            return chartColors.levels[level] || '#6c757d';
        });
        
        const ctx = document.getElementById('levelDistributionChart').getContext('2d');
        
        // ì´ì „ ì°¨íŠ¸ ì‚­ì œ
        if (levelChart) {
            levelChart.destroy();
        }
        
        // ìƒˆ ì°¨íŠ¸ ìƒì„± - íŒŒì´ ì°¨íŠ¸ì—ì„œ ë°” ì°¨íŠ¸ë¡œ ë³€ê²½
        levelChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    data: counts,
                    backgroundColor: backgroundColors,
                    borderWidth: 0,
                    borderRadius: 8,
                    maxBarThickness: 60,
                    hoverOffset: 10
                }]
            },
            options: {
                indexAxis: 'y', // ìˆ˜í‰ ë°” ì°¨íŠ¸
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        beginAtZero: true,
                        grid: {
                            color: chartColors.grid,
                            drawBorder: false
                        },
                        ticks: {
                            precision: 0, // ì •ìˆ˜ë§Œ í‘œì‹œ
                            font: {
                                weight: 'bold'
                            },
                            padding: 10
                        }
                    },
                    y: {
                        grid: {
                            display: false,
                            drawBorder: false
                        },
                        ticks: {
                            font: {
                                weight: 'bold',
                                size: 13
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    title: {
                        display: true,
                        text: 'ë¡œê·¸ ë ˆë²¨ ë¶„í¬',
                        font: {
                            size: 16,
                            weight: 'bold'
                        },
                        padding: {top: 10, bottom: 20}
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleFont: {
                            weight: 'bold'
                        },
                        bodyFont: {
                            size: 14
                        },
                        callbacks: {
                            label: function(context) {
                                const percent = Math.round(
                                    (context.raw / counts.reduce((a, b) => a + b, 0)) * 100
                                );
                                return [`${context.raw}ê±´ (${percent}%)`, `ì „ì²´ ë¡œê·¸ ì¤‘ ${percent}%`];
                            }
                        },
                        displayColors: false,
                        padding: 12,
                        cornerRadius: 8
                    }
                },
                animation: {
                    duration: 1200,
                    easing: 'easeOutQuart'
                }
            }
        });
    }
    
    // ìƒíƒœ ì½”ë“œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
    function updateStatusChart(data) {
        if (!data || data.length === 0) return;
        
        const labels = data.map(item => item.status.toString());
        const counts = data.map(item => item.count);
        
        // ìƒíƒœ ì½”ë“œì— ë”°ë¥¸ ìƒ‰ìƒ ì§€ì •
        const backgroundColors = labels.map(status => {
            const statusCode = parseInt(status);
            if (statusCode >= 500) return chartColors.status['5xx'];
            if (statusCode >= 400) return chartColors.status['4xx'];
            if (statusCode >= 300) return chartColors.status['3xx'];
            if (statusCode >= 200) return chartColors.status['2xx'];
            return '#6c757d';
        });
        
        const ctx = document.getElementById('statusDistributionChart').getContext('2d');
        
        // ì´ì „ ì°¨íŠ¸ ì‚­ì œ
        if (statusChart) {
            statusChart.destroy();
        }
        
        // ìƒˆ ì°¨íŠ¸ ìƒì„± - ìˆ˜í‰ ë°” ì°¨íŠ¸ ìœ ì§€
        statusChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    data: counts,
                    backgroundColor: backgroundColors,
                    borderWidth: 0,
                    borderRadius: 8,
                    maxBarThickness: 60,
                    hoverOffset: 10
                }]
            },
            options: {
                indexAxis: 'y', // ìˆ˜í‰ ë°” ì°¨íŠ¸
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        beginAtZero: true,
                        grid: {
                            color: chartColors.grid,
                            drawBorder: false
                        },
                        ticks: {
                            precision: 0, // ì •ìˆ˜ë§Œ í‘œì‹œ
                            font: {
                                weight: 'bold'
                            },
                            padding: 10
                        }
                    },
                    y: {
                        grid: {
                            display: false,
                            drawBorder: false
                        },
                        ticks: {
                            font: {
                                weight: 'bold',
                                size: 13
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    title: {
                        display: true,
                        text: 'HTTP ìƒíƒœ ì½”ë“œ ë¶„í¬',
                        font: {
                            size: 16,
                            weight: 'bold'
                        },
                        padding: {top: 10, bottom: 20}
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleFont: {
                            weight: 'bold'
                        },
                        bodyFont: {
                            size: 14
                        },
                        callbacks: {
                            label: function(context) {
                                const statusCode = parseInt(context.label);
                                let statusText = '';
                                if (statusCode >= 500) statusText = 'ì„œë²„ ì˜¤ë¥˜';
                                else if (statusCode >= 400) statusText = 'í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¥˜';
                                else if (statusCode >= 300) statusText = 'ë¦¬ë‹¤ì´ë ‰ì…˜';
                                else if (statusCode >= 200) statusText = 'ì„±ê³µ';
                                else statusText = 'ì •ë³´';
                                
                                const percent = Math.round(
                                    (context.raw / counts.reduce((a, b) => a + b, 0)) * 100
                                );
                                
                                return [
                                    `ìƒíƒœ ì½”ë“œ: ${context.label} (${statusText})`, 
                                    `${context.raw}ê±´ (${percent}%)`
                                ];
                            }
                        },
                        displayColors: false,
                        padding: 12,
                        cornerRadius: 8
                    }
                },
                animation: {
                    duration: 1200,
                    easing: 'easeOutQuart'
                }
            }
        });
    }
    
    // í†µê³„ íƒ­ ì „í™˜ í•¨ìˆ˜
    function openStatsTab(evt, tabName) {
        const tabcontent = document.querySelectorAll("#statsModal .tabcontent");
        tabcontent.forEach(tab => tab.classList.remove("active"));
        
        const tablinks = document.querySelectorAll("#statsModal .tablinks");
        tablinks.forEach(link => link.classList.remove("active"));
        
        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.classList.add("active");
    }

    // íƒ­ ì „í™˜ í•¨ìˆ˜
    function openTab(evt, tabName) {
        const tabcontent = document.getElementsByClassName("tabcontent");
        for (let i = 0; i < tabcontent.length; i++) {
            tabcontent[i].classList.remove("active");
        }

        const tablinks = document.getElementsByClassName("tablinks");
        for (let i = 0; i < tablinks.length; i++) {
            tablinks[i].classList.remove("active");
        }

        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.classList.add("active");
    }

    // í•„í„° ì˜µì…˜ ë¡œë“œ í•¨ìˆ˜
    async function loadFilterOptions() {
        try {
            const response = await fetch('/filters');
            if (!response.ok) {
                console.error('Failed to fetch filter options:', response.statusText);
                return;
            }

            const filterOptions = await response.json();

            // ê° í•„í„° ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
            populateFilterDropdown('apiKey-filter', filterOptions.apiKeys || []);
            populateFilterDropdown('service-filter', filterOptions.services || []);
            populateFilterDropdown('level-filter', filterOptions.levels || []);
            populateFilterDropdown('status-filter', filterOptions.statusCodes || []);

        } catch (error) {
            console.error('Error loading filter options:', error);
        }
    }

    // ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸° í•¨ìˆ˜
    function populateFilterDropdown(elementId, options) {
        const dropdown = document.getElementById(elementId);
        const currentValue = dropdown.value; // í˜„ì¬ ì„ íƒ ê°’ ì €ì¥

        // ì²« ë²ˆì§¸ ì˜µì…˜ ("ì „ì²´") ìœ ì§€, ë‚˜ë¨¸ì§€ ì œê±°
        while (dropdown.options.length > 1) {
            dropdown.remove(1);
        }

        // ìƒˆ ì˜µì…˜ ì¶”ê°€
        options.forEach(option => {
            if (option) { // nullì´ë‚˜ ë¹ˆ ê°’ ì œì™¸
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                dropdown.appendChild(optionElement);
            }
        });

        // ì´ì „ì— ì„ íƒí•œ ê°’ ë³µì› (ê°€ëŠ¥í•œ ê²½ìš°)
        if (currentValue && [...dropdown.options].some(o => o.value === currentValue)) {
            dropdown.value = currentValue;
        }
    }

    // ë¡œê·¸ ìƒì„¸ ì •ë³´ ë³´ê¸° í•¨ìˆ˜
    async function showLogDetail(index) {
        try {
            // APIë¥¼ í†µí•´ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const response = await fetch(`/logs/detail/${index}`);
            if (!response.ok) {
                console.error('Failed to fetch log details:', response.statusText);
                return;
            }
            
            const detailLog = await response.json();
            if (!detailLog) return;

            // ê¸°ë³¸ ì •ë³´
            let basicInfoHtml = `
                <p><strong>íƒ€ì„ìŠ¤íƒ¬í”„:</strong> ${convertToKST(detailLog.timestamp)}</p>
                <p><strong>ë¡œê·¸ ë ˆë²¨:</strong> <span class="level-${detailLog.level}">${detailLog.level}</span></p>
                <p><strong>ë©”ì‹œì§€:</strong> ${escapeHtml(detailLog.message)}</p>
                <p><strong>ë¡œê±°:</strong> ${detailLog.logger}</p>
                <p><strong>ìŠ¤ë ˆë“œ:</strong> ${detailLog.thread}</p>
                <p><strong>ì„œë¹„ìŠ¤:</strong> ${detailLog.serviceName}</p>
                <p><strong>í™˜ê²½:</strong> ${detailLog.environment}</p>
                <p><strong>API í‚¤:</strong> ${detailLog.apiKey}</p>
            `;
            document.getElementById('basicInfo').innerHTML = basicInfoHtml;

            // ìš”ì²­ ì •ë³´
            let requestInfoHtml = `<p>ìš”ì²­ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
            if (detailLog.requestMethod || detailLog.requestUri) {
                requestInfoHtml = `
                <p><strong>ìš”ì²­ ID:</strong> ${detailLog.requestId || '-'}</p>
                <p><strong>HTTP ë©”ì†Œë“œ:</strong> ${detailLog.requestMethod || '-'}</p>
                <p><strong>URI:</strong> ${detailLog.requestUri || '-'}</p>
                <p><strong>í´ë¼ì´ì–¸íŠ¸ IP:</strong> ${detailLog.clientIp || '-'}</p>
                <p><strong>User-Agent:</strong> ${detailLog.userAgent || '-'}</p>
                <p><strong>HTTP ìƒíƒœ:</strong> ${detailLog.httpStatus || '-'}</p>
                <p><strong>ëª¨ë°”ì¼:</strong> ${detailLog.uaMobile !== undefined ? (detailLog.uaMobile ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤') : '-'}</p>
                <p><strong>í”Œë«í¼:</strong> ${detailLog.uaPlatform || '-'}</p>
            `;
            }
            document.getElementById('requestInfo').innerHTML = requestInfoHtml;

            // ì„±ëŠ¥ ì§€í‘œ
            let performanceInfoHtml = `<p>ì„±ëŠ¥ ì§€í‘œê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
            if (detailLog.performanceMetrics && Object.keys(detailLog.performanceMetrics).length > 0) {
                performanceInfoHtml = Object.entries(detailLog.performanceMetrics)
                    .map(([key, value]) => `<p><strong>${key}:</strong> ${value}</p>`)
                    .join('');
            }
            document.getElementById('performanceInfo').innerHTML = performanceInfoHtml;

            // MDC ì»¨í…ìŠ¤íŠ¸
            let mdcInfoHtml = `<p>MDC ì»¨í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
            if (detailLog.mdcContext && Object.keys(detailLog.mdcContext).length > 0) {
                mdcInfoHtml = Object.entries(detailLog.mdcContext)
                    .map(([key, value]) => `<p><strong>${key}:</strong> ${escapeHtml(String(value))}</p>`)
                    .join('');
            }
            document.getElementById('mdcInfo').innerHTML = mdcInfoHtml;

            // í—¤ë” ì •ë³´
            let headersInfoHtml = `<p>í—¤ë” ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
            if (detailLog.headers && Object.keys(detailLog.headers).length > 0) {
                headersInfoHtml = `<h4>ìš”ì²­ í—¤ë”</h4>`;
                headersInfoHtml += Object.entries(detailLog.headers)
                    .map(([key, value]) => `<p><strong>${key}:</strong> ${escapeHtml(String(value))}</p>`)
                    .join('');
            }
            if (detailLog.responseHeaders && Object.keys(detailLog.responseHeaders).length > 0) {
                headersInfoHtml += `<h4>ì‘ë‹µ í—¤ë”</h4>`;
                headersInfoHtml += Object.entries(detailLog.responseHeaders)
                    .map(([key, value]) => `<p><strong>${key}:</strong> ${escapeHtml(String(value))}</p>`)
                    .join('');
            }
            document.getElementById('headersInfo').innerHTML = headersInfoHtml;

            // ì˜¤ë¥˜ ì •ë³´
            let errorInfoHtml = `<p>ì˜¤ë¥˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
            if (detailLog.throwable && Object.keys(detailLog.throwable).length > 0) {
                errorInfoHtml = `
                <p><strong>ì˜ˆì™¸ í´ë˜ìŠ¤:</strong> ${detailLog.throwable.className || '-'}</p>
                <p><strong>ì—ëŸ¬ ë©”ì‹œì§€:</strong> ${detailLog.throwable.message || '-'}</p>
            `;

                if (detailLog.throwable.stackTrace && detailLog.throwable.stackTrace.length > 0) {
                    errorInfoHtml += `<p><strong>ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤:</strong></p><pre>${detailLog.throwable.stackTrace.join('\n')}</pre>`;
                }

                if (detailLog.throwable.cause) {
                    errorInfoHtml += `
                    <p><strong>ì›ì¸ ì˜ˆì™¸:</strong> ${detailLog.throwable.cause.className || '-'}</p>
                    <p><strong>ì›ì¸ ë©”ì‹œì§€:</strong> ${detailLog.throwable.cause.message || '-'}</p>
                `;
                }
            }
            document.getElementById('errorInfo').innerHTML = errorInfoHtml;

            // ê°€ê³µëœ í•„ë“œ ë·°
            const allFieldsObj = {...detailLog};
            if (allFieldsObj.rawJson) delete allFieldsObj.rawJson; // rawJson í•„ë“œ ì œê±°
            document.getElementById('allFields').textContent = JSON.stringify(allFieldsObj, null, 2);

            // ëª¨ë‹¬ í‘œì‹œ
            modal.style.display = "block";

        } catch (error) {
            console.error('Error showing log details:', error);
        }
    }

    // ë¡œê·¸ ë¡œë“œ í•¨ìˆ˜
    async function loadLogs() {
        try {
            // í•„í„° ì ìš©í•˜ì—¬ URL êµ¬ì„±
            let url = '/logs';
            const params = new URLSearchParams();

            if (filters.apiKey) params.append('apiKey', filters.apiKey);
            if (filters.path) params.append('path', filters.path);
            if (filters.level) params.append('level', filters.level);
            // ì—¬ëŸ¬ íŒŒë¼ë¯¸í„° ì´ë¦„ ì§€ì›
            if (filters.status) {
                params.append('status', filters.status);
                params.append('httpStatus', filters.status);
                params.append('statusStr', filters.status);
            }
            if (filters.service) {
                params.append('service', filters.service);
                params.append('serviceName', filters.service);
            }
            if (filters.query) params.append('query', filters.query);
            if (filters.timeRange) params.append('timeRange', filters.timeRange);

            const queryString = params.toString();
            if (queryString) {
                url += '?' + queryString;
            }

            const response = await fetch(url);
            if (!response.ok) {
                console.error('Failed to fetch logs:', response.statusText);
                return;
            }

            const logs = await response.json();
            // í˜„ì¬ ë¡œê·¸ ë°ì´í„° ì €ì¥
            currentLogs = logs;

            const tbody = document.querySelector('#logs-table tbody');

            // í…Œì´ë¸” ì´ˆê¸°í™”
            tbody.innerHTML = '';

            // ë¡œê·¸ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            document.getElementById('log-count').textContent = logs.length;

            if (!logs || logs.length === 0) {
                // ë¡œê·¸ê°€ ì—†ì„ ë•Œ ë©”ì‹œì§€ í‘œì‹œ
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="6" style="text-align: center; color: #888;">No logs yet...</td>`;
                tbody.appendChild(row);
                return;
            }

            // ë¡œê·¸ ë°ì´í„° í‘œì‹œ (ì´ë¯¸ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ìµœì‹  ìˆœìœ¼ë¡œ ì •ë ¬ë¨)
            logs.forEach((log, index) => {
                const row = document.createElement('tr');
                row.setAttribute('data-index', index);
                row.addEventListener('click', () => showLogDetail(index));

                // ì£¼ìš” í•„ë“œ í‘œì‹œ
                const timestamp = log.timestamp ? convertToKST(log.timestamp) : 'N/A';
                const level = log.level || 'UNKNOWN';
                const logger = log.logger ? log.logger.split('.').pop() : 'N/A';
                const service = log.serviceName || 'N/A';
                const requestId = log.requestId || '-';

                // ë©”ì‹œì§€ ë° ìƒì„¸ ì •ë³´ êµ¬ì„±
                let messageDetailsHtml = `<div class="message">${escapeHtml(log.message || '')}</div>`;

                // HTTP ìš”ì²­ ì •ë³´ ì¶”ê°€ (ìˆëŠ” ê²½ìš°)
                if (log.requestMethod && log.requestUri) {
                    messageDetailsHtml += `<div class="http-info" style="font-size:0.9em; color: #0066cc;">${log.requestMethod} ${log.requestUri}`
                    if (log.httpStatus) {
                        messageDetailsHtml += ` -> ${log.httpStatus}`;
                    }
                    if(log.performanceMetrics && log.performanceMetrics.responseTime >= 0) {
                        messageDetailsHtml += ` (${log.performanceMetrics.responseTime}ms)`;
                    }
                    messageDetailsHtml += `</div>`;
                }

                // ì˜ˆì™¸ ì •ë³´ ì¶”ê°€ (ìˆëŠ” ê²½ìš°)
                if (log.throwable) {
                    messageDetailsHtml += `<div class="error-details"><strong>Error:</strong> ${escapeHtml(log.throwable.className || '')}: ${escapeHtml(log.throwable.message || '')}</div>`;
                }

                // MDC ì •ë³´ ì¶”ê°€ (ìˆëŠ” ê²½ìš°)
                if (log.mdcContext) {
                    const mdcEntries = Object.entries(log.mdcContext)
                        .filter(([key]) => key !== 'requestId' && key !== 'requestMethod')
                        .map(([key, value]) => `  ${key}: ${escapeHtml(String(value))}`)
                        .join('\n');

                    if (mdcEntries.length > 0) {
                        messageDetailsHtml += `<div class="mdc-details"><strong>MDC:</strong>\n${mdcEntries}</div>`;
                    }
                }

                // API í‚¤ ì •ë³´ ì¶”ê°€ (ì„œë¹„ìŠ¤ ì‹ë³„)
                if (log.apiKey) {
                    messageDetailsHtml += `<div style="font-size:0.8em; color: #666; margin-top: 5px;">API Key: ${log.apiKey}</div>`;
                }

                row.innerHTML = `
                        <td>${timestamp}</td>
                        <td><span class="level-${level}">${level}</span></td>
                        <td>${logger}</td>
                        <td>${service}</td>
                        <td>${requestId}</td>
                        <td>${messageDetailsHtml}</td>
                    `;

                tbody.appendChild(row);
            });

        } catch (error) {
            console.error('Error loading or processing logs:', error);
        }
    }

    // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
    function escapeHtml(unsafe) {
        if (!unsafe) return '';
        return unsafe
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }

    // í•„í„° ì ìš© ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    document.getElementById('apply-filters').addEventListener('click', () => {
        // ëª¨ë“  í•„í„° ê°’ ìˆ˜ì§‘
        filters.apiKey = document.getElementById('apiKey-filter').value;
        filters.service = document.getElementById('service-filter').value;
        filters.level = document.getElementById('level-filter').value;
        filters.status = document.getElementById('status-filter').value;
        filters.path = document.getElementById('path-filter').value;
        filters.query = document.getElementById('query-filter').value;
        filters.timeRange = document.getElementById('timeRange-filter').value;

        // ë¡œê·¸ ìƒˆë¡œê³ ì¹¨
        loadLogs();
    });

    // í•„í„° ì´ˆê¸°í™” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    document.getElementById('reset-filters').addEventListener('click', () => {
        // ëª¨ë“  í•„í„° ì´ˆê¸°í™”
        document.getElementById('apiKey-filter').value = '';
        document.getElementById('service-filter').value = '';
        document.getElementById('level-filter').value = '';
        document.getElementById('status-filter').value = '';
        document.getElementById('path-filter').value = '';
        document.getElementById('query-filter').value = '';
        document.getElementById('timeRange-filter').value = '24h';

        // í•„í„° ê°ì²´ë„ ì´ˆê¸°í™”
        Object.keys(filters).forEach(key => filters[key] = '');

        // ë¡œê·¸ ìƒˆë¡œê³ ì¹¨
        loadLogs();
    });

    // ì—”í„° í‚¤ë¡œ í•„í„° ì ìš©
    document.getElementById('path-filter').addEventListener('keyup', (e) => {
        if (e.key === 'Enter') document.getElementById('apply-filters').click();
    });

    document.getElementById('query-filter').addEventListener('keyup', (e) => {
        if (e.key === 'Enter') document.getElementById('apply-filters').click();
    });

    // ì´ˆê¸° ë¡œë“œ ë° ì£¼ê¸°ì  ì—…ë°ì´íŠ¸
    window.addEventListener('load', () => {
        loadFilterOptions();
        loadLogs();

        // ì£¼ê¸°ì  ì—…ë°ì´íŠ¸
        setInterval(() => {
            loadLogs();
            // í•„í„° ì˜µì…˜ë„ ì£¼ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ (í•˜ì§€ë§Œ ë¡œê·¸ë³´ë‹¤ ëœ ìì£¼)
            if (Math.random() < 0.2) { // ì•½ 20% í™•ë¥ ë¡œ í•„í„° ì˜µì…˜ ì—…ë°ì´íŠ¸
                loadFilterOptions();
            }
        }, 3000);
    });
</script>
</body>
</html>