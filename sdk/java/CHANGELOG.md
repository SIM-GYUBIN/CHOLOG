# CHANGELOG

## [v1.0.6] - 2025-05-16
### 개선 사항
* **예외 정보 필드명 수정**:
  - 예외 정보를 담는 필드명을 `throwable`에서 `error`로 변경
  - 필드명 일관성 개선 및 표준화 
  - 모든 오류 로그에서 일관된 필드명 사용으로 검색 용이성 향상
* **HTTP 관련 필드 그룹화 버그 수정**:
  - HTTP 필드가 루트 레벨에 중복해서 남아있는 문제 수정
  - `responseTime` 필드도 루트 레벨에서 제거하도록 로직 추가
  - 일관된 로그 포맷 유지를 위한 코드 개선
* **환경 정보 필드 표준화**:
  - 기존 `environment` 필드를 제거하고 Spring 활성 프로필 정보를 `environment` 필드로 통합
  - `profiles` 필드명을 `environment`로 변경하여 명확성 향상
  - Spring 환경 설정과 로그 필드명 간의 일관성 개선

## [v1.0.4] - 2025-05-15
### 개선 사항
* **HTTP 관련 필드 그룹화**:
  - HTTP 관련 필드(requestMethod, requestUri, httpStatus, responseTime)를 `http` 객체로 그룹화
  - 로그 구조 정리 및 중복 필드 제거
  - 로그 JSON 형식 일관성 향상
* **응답 시간 필드 이동**:
  - `responseTime` 필드를 `performanceMetrics`에서 `http` 객체로 이동
  - 관련 필드 논리적 그룹화 강화
* **예외 상태 코드 처리 개선**:
  - 예외 발생 시 HTTP 상태 코드 설정 로직을 `http` 객체에 적용
  - 모든 에러 시나리오에서 일관된 로그 형식 제공
* **로그 가독성 향상**:
  - 연관된 정보 그룹화로 로그 분석 용이성 개선
  - Kibana와 같은 로그 분석 도구에서 쿼리 구성 간소화
  - 계층적 필드 구조로 고급 필터링 기능 지원

## [v1.0.3] - 2025-05-14
### 개선 사항
* **스레드 기반 requestId 추적 기능 추가**:
  - 같은 스레드에서 발생하는 모든 로그에 요청 ID를 자동으로 연결
  - Tomcat 컨테이너 에러 로그와 애플리케이션 로그 간 requestId 연결
  - 요청 추적 및 디버깅 용이성 개선
* **CentralLogAppender 기능 개선**:
  - 스레드별 requestId 캐시를 위한 ConcurrentHashMap 도입
  - 로그 발생 스레드를 기준으로 requestId 자동 연결
  - 에러 로그 발생 시 자동으로 캐시된 requestId 적용
* **스마트 에러 감지 강화**:
  - Tomcat, Spring 및 일반 에러 패턴에 대한 정교한 감지 알고리즘 개선
  - 특히 컨테이너 레벨 로그와 애플리케이션 에러 로그 연결성 향상
* **메모리 관리 최적화**:
  - 장기 실행 애플리케이션을 위한 캐시 정리 메커니즘 추가
  - 스레드 맵이 과도하게 커지는 것을 방지하는 정리 로직 구현

## [v1.0.2] - 2025-05-13
### 개선 사항
* **민감 파라미터 필터링 강화**:
  - `RequestTimingFilter`에 민감 파라미터 필터링 로직 추가
  - MDC에 `request_param_*` 형태로 저장되는 파라미터들에 대한 자동 마스킹 처리
  - 사용자 설정 마스킹 문자열(`sensitiveValueReplacement`) 적용 확대
* **내부 필터링 로직 통합**:
  - 기존 `RequestResponseLoggingFilter`와 동일한 민감 정보 키워드 목록을 `RequestTimingFilter`에서도 사용
  - 두 필터에서 모두 `LogServerProperties` 설정값을 활용한 일관된 필터링 적용
* **보안 강화**:
  - `password`, `ssn`, `token` 등 다양한 민감 파라미터 유형에 대한 자동 마스킹 처리 개선
  - 마스킹 불일치 문제 해결로 로그에서 민감 정보 노출 가능성 제거

## [v1.0.1] - 2025-05-12
### 개선 사항
* **민감정보 필터링 최적화**:
  - `RequestResponseLoggingFilter`에서 `LogServerProperties`의 `sensitiveValueReplacement` 설정값을 활용하도록 개선
  - 중첩된 JSON 구조에서의 민감정보 필터링 알고리즘 개선
  - `FilterContext` 객체 도입으로 필터링 상태 추적 향상
* **압축 로직 리팩토링**:
  - 중복된 GZIP 압축 관련 코드를 공통 메서드로 분리하여 코드 유지보수성 개선
  - `createRequestEntity()` 메서드 도입으로 요청 엔티티 생성 로직 표준화
  - 설정 옵션 이름 변경: `compression-enabled` → `compress-logs` (기존 설정 호환성 유지)
* **디스크 큐 관리 최적화**:
  - 디스크 용량 관리를 위한 전용 메서드 구현
  - 파일 저장 로직을 별도 메서드로 분리하여 재사용성 향상
  - 동시성 제어 메커니즘 강화
* **예외 처리 개선**:
  - 재시도 로직 개선과 오류 로그 명확화
  - 지수 백오프 관련 코드 모듈화
* **성능 최적화**:
  - 메모리 사용량 최적화 및 대용량 로그 처리 시 성능 향상
  - 불필요한 정보 로깅 최소화

## [v1.0.0] - 2025-05-11
- chologger 최초 공개
- Spring Boot 자동 설정 지원
- HTTP 요청/응답, 예외, 애플리케이션 로그 자동 수집
- 중앙 로그 서버(ELK 등)로 비동기/배치 전송
- 민감 정보 자동 필터링, GZIP 압축 지원
- 디스크 큐, JMX 상태 모니터링 등 다양한 고급 기능 포함

## v1.8.6

### 개선 사항
* **(CHO:LOG) X-Request-Id 헤더 지원**: 
  - 프론트엔드에서 전달된 X-Request-Id 헤더를 감지하여 로그의 requestId로 사용
  - RequestTimingFilter에 X-Request-Id 헤더 감지 로직 추가
  - 헤더가 없는 경우 기존처럼 UUID 자동 생성
* **분산 시스템 연계 강화**:
  - 프론트엔드와 백엔드 간 요청 추적 통합 지원
  - 마이크로서비스 환경에서 서비스 간 요청 흐름 추적 개선
* **Spring 활성 프로필 로깅**:
  - Spring의 활성 프로필 정보를 로그의 'profiles' 필드에 추가
  - 기본 프로필만 있는 경우 "(default)" 접미사 추가
* **기본 CORS 설정 지원**:
  - `cholog.logger.cors-enabled=true` 설정으로 기본 CORS 필터 활성화
  - 모든 오리진, 헤더, 메소드를 허용하는 기본 설정 제공
* **코드 및 문서화 개선**:
  - X-Request-Id 헤더 지원에 대한 README 문서 추가
  - 프론트엔드 연동 예제 코드 추가
  - Javadoc 및 코드 주석 업데이트

## v1.8.5

### 개선 사항
* **컨테이너 예외 로깅 강화**: Tomcat, Spring 컨테이너 예외 로그에 상태 코드 설정 로직 추가
* **CentralLogAppender 개선**: 
  - 다양한 예외 패턴 감지 알고리즘 추가
  - 로그 메시지와 로거 이름 패턴 분석으로 예외 감지 강화
  - 모든 타입의 ERROR 로그에서 예외 감지 시 상태 코드 자동 설정
* **오류 로그 일관성 향상**: 컨테이너 레벨부터 애플리케이션 레벨까지 모든 오류에 상태 코드 보장

## v1.8.4

### 개선 사항
* **상태 코드 처리 개선**: Tomcat 컨테이너 로그를 포함한 모든 예외 로그에 HTTP 상태 코드가 정확히 표시되도록 개선
* **GlobalExceptionHandler 개선**: 모든 예외 처리 시 HTTP 상태 코드를 500으로 명시적으로 설정
* **RequestTimingFilter 개선**: 
  - 예외 발생 시 상태 코드를 자동으로 추론하여 MDC에 추가
  - 에러 정보가 있는 경우 상태 코드가 없으면 자동으로 500으로 설정
* **오류 로그 일관성 향상**: Tomcat, Spring, 애플리케이션 레벨의 모든 오류에 대해 일관된 로깅 제공

## v1.8.3

### 개선 사항
* **500 에러 로깅 개선**: 예외 발생 시 에러 정보가 로그에 정확히 포함되도록 개선
* **GlobalExceptionHandler 개선**: 예외 처리 후 MDC에서 에러 정보를 제거하지 않도록 수정
* **RequestTimingFilter 개선**: 예외 발생 시 예외 정보를 MDC에 추가하는 기능 구현
* **MDC 관리 개선**: RequestTimingFilter의 finally 블록에서 모든 MDC 항목을 정확히 제거하도록 수정
* **LogEntry JSON 직렬화 개선**: null 값도 항상 JSON에 포함되도록 설정(JsonInclude.Include.ALWAYS)

## v1.8.2

### 개선 사항
* **Logback 통합 개선**: CentralLogAppender 초기화 과정 최적화로 "No context given" 경고 메시지 해결
* **컨텍스트 초기화 안정성 향상**: 컨텍스트가 null인 경우 예외 처리 및 자동 설정 기능 추가
* **코드 안정성 개선**: setName, start 메서드 오버라이드하여 로그백 초기화 과정 강화
* **경고 메시지 처리**: Logback 경고 메시지가 발생하지 않도록 초기화 과정 개선

## v1.8.1

### 개선 사항
* **Logback 통합 개선**: CentralLogAppender의 초기화 순서를 최적화하여 Context 관련 경고 메시지 감소
* **무해한 경고 처리**: 'No context given' 경고가 표시되더라도 기능에 영향이 없음을 확인

## v1.8.0

### 개선 사항
* **필드명 통일**: applicationName에서 serviceName으로 필드명 통일 (역호환성 유지)
* **로그 완전성 보장**: 서비스 이름이 설정되지 않은 경우에도 기본값 제공
* **HTTP 헤더 메타데이터 개선**: 로그 전송 시 사용되는 헤더 정보 최적화
* **문서화 개선**: 필드명 변경에 따른 설정 문서 업데이트

## v1.7.9

### 버그 수정
* **불완전한 로그 객체 전송 문제 해결**: 디스크에서 읽은 JSON 배열 로그를 전송할 때 타임스탬프만 있는 불완전한 로그 객체가 생성되는 문제 수정
* **디스크 큐 로그 처리 개선**: 디스크에 저장된 로그 배치가 중복 배열화되지 않도록 처리 방식 최적화
* **로그 배치 JSON 형식 처리 개선**: 이미 JSON 배열 형식인 로그 배치를 올바르게 처리하는 전용 메소드 추가

## v1.7.8

### 개선 사항
* **스마트 로그 출력 개선**: 상태 변경 시에만 로그 출력으로 불필요한 반복 로그 제거
* **디버그 수준 로깅 최적화**: 재시도 진행 로그를 디버그 레벨로 변경하여 과도한 로그 방지
* **로그 품질 향상**: 중요 로그만 INFO/WARN 레벨로 출력하여 로그 가독성 극대화

## v1.7.7

### 개선 사항
* **간결한 오류 로그**: 네트워크 오류 시 스택 트레이스 제거로 로그 가독성 개선
* **재시도 로직 개선**: 각 재시도마다 명확한 로그 출력으로 진행 상황 파악 용이 
* **디스크 큐 관련 로그 개선**: 로그 유실 가능성에 대한 명확한 경고 메시지 추가

## v1.7.6

### 개선 사항
* **연결 오류 로그 억제 기능 개선**: 서버 연결 상태 확인 과정에서도 같은 빈도로 로그가 출력되도록 수정
* **서버 상태 변경 메시지 최적화**: 서버 상태 변경 시에도 로그 억제 설정이 적용되도록 개선
* **안정성 개선**: 네트워크 불안정 상황에서 과도한 로그 출력 방지

## v1.7.5

### 개선 사항
* **연결 오류 로그 최적화**: 네트워크 연결 문제 시 과도한 로그 출력을 방지하는 지능형 로그 억제 기능 추가
* **지수 백오프 전략**: 서버 연결 실패 시 점진적으로 재시도 간격을 늘리는 지수 백오프 알고리즘 적용
* **디스크 저장 로그 최소화**: 과도한 디스크 큐 관련 로그를 줄이는 설정 추가
* **기본 설정 최적화**: 실제 운영 환경에 최적화된 기본값 조정

## v1.7.4

### 개선 사항
* **문서 개선**: 로그 필드 형식과 모든 설정 옵션을 상세하게 문서화
* **매핑 명확화**: 설정 옵션과 로그 필드 간의 연결 관계 명확히 제공
* **사용자 가이드 개선**: 로그 필터링 및 활용을 위한 상세 가이드 추가
* **코드 검토 개선**: 전체 코드 검토 및 소스 코드 품질 개선

## v1.7.3

### 개선 사항
* **로그 필드명 일관성 개선**: `application-name` 설정이 로그에서 `serviceName` 필드로 올바르게 출력되도록 수정
* **버그 수정**: 버그 수정 및 코드 정리
* **인코딩 문제 해결**: javadoc 생성 시 UTF-8 인코딩 명시적 지원 추가

## v1.7.0

### 주요 개선 사항
* **설정 통합**: `cholog.api` 접두사를 제거하고 모든 설정을 `cholog.logger` 아래로 통합
* **내부 구조 개선**: 코드 중복 제거 및 일관된 설정 구조로 개선
* **응답 헤더 로그 형식 개선**: 응답 헤더를 JSON 문자열 대신 객체 형태로 저장하여 검색 및 필터링 용이성 향상

### 성능 및 안정성 개선
* **안정성 개선**: 다양한 환경에서의 테스트를 통한 버그 수정 및 안정성 향상
* **스레드 안전성 강화**: 멀티스레드 환경에서의 로그 처리 성능 및 안정성 개선
* **메모리 사용량 최적화**: 대용량 로그 처리 시 메모리 사용량 감소
* **로깅 필터 성능 개선**: HTTP 요청/응답 로깅 필터의 성능 최적화

### 기능 개선
* **재시도 로직 개선**: 로그 전송 실패 시 지수 백오프(exponential backoff) 전략 적용
* **민감 정보 필터링 확장**: 더 정교한 패턴 매칭을 통한 민감 정보 보호 강화
* **로그 압축 알고리즘 최적화**: 압축률과 CPU 사용량 간의 균형을 개선한 압축 설정
* **ELK 스택 통합 개선**: 최신 ELK 버전과의 호환성 향상 및 통합 가이드 업데이트
* **의존성 업데이트**: 보안 취약점 패치 및 성능 개선을 위한 라이브러리 업데이트
* **문서화 개선**: 더 명확한 사용법과 문제 해결 가이드 제공 