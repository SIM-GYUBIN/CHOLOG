"use strict";var Cholog=(()=>{var v=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var S=(s,e)=>{for(var o in e)v(s,o,{get:e[o],enumerable:!0})},I=(s,e,o,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of C(e))!q.call(s,i)&&i!==o&&v(s,i,{get:()=>e[i],enumerable:!(t=E(e,i))||t.enumerable});return s};var R=s=>I(v({},"__esModule",{value:!0}),s);var T={};S(T,{Cholog:()=>w,default:()=>k});var u=class{static{this.currentRequestId=null}static startNewRequest(){return this.currentRequestId=this.generateId(),this.currentRequestId}static getCurrentRequestId(){return this.currentRequestId}static setCurrentRequestId(e){this.currentRequestId=e}static generateId(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`request-${Date.now()}-${Math.random().toString(36).substring(2,11)}`}};var l=class{static{this.apiKey=""}static{this.environment="default"}static{this.apiEndpoint="https://cholog-server.shop/api/logs/js"}static{this.originalConsole=null}static{this.logQueue=[]}static{this.batchInterval=1e3}static{this.batchTimeoutId=null}static{this.maxQueueSize=100*1024}static{this.currentQueueSize=0}static{this.logSequenceCounter=0}static init(e){if(this.originalConsole!==null){console.warn("[CHO:LOG] \uC774\uBBF8 \uCD08\uAE30\uD654\uB41C \uC0C1\uD0DC\uC785\uB2C8\uB2E4..");return}this.apiKey=e.apiKey,e.environment&&(this.environment=e.environment),e.batchInterval&&(this.batchInterval=e.batchInterval),e.maxQueueSize&&(this.maxQueueSize=e.maxQueueSize),this.overrideConsoleMethods()}static getApiEndpoint(){return this.apiEndpoint}static overrideConsoleMethods(){this.originalConsole={log:console.log.bind(console),info:console.info.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),debug:console.debug.bind(console),trace:console.trace.bind(console)},console.log=(...e)=>this.queueAndPrint("info","console",...e),console.info=(...e)=>this.queueAndPrint("info","console",...e),console.warn=(...e)=>this.queueAndPrint("warn","console",...e),console.error=(...e)=>this.queueAndPrint("error","console",...e),console.debug=(...e)=>this.queueAndPrint("debug","console",...e),console.trace=(...e)=>this.queueAndPrint("trace","console",...e)}static queueAndPrint(e,o,...t){if(this.originalConsole){let i=this.originalConsole[e];i?i(...t):this.originalConsole.log(...t)}this.prepareAndQueueLog(e,o,t)}static prepareAndQueueLog(e,o,t,i,n,c,r){if(!this.apiKey||!this.environment){this.originalConsole?this.originalConsole.warn("[CHO:LOG] SDK\uAC00 \uCD08\uAE30\uD654\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4. \uB85C\uADF8\uAC00 \uC804\uC1A1\uB418\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.",...t):console.warn("[CHO:LOG] SDK\uAC00 \uCD08\uAE30\uD654\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4. \uB85C\uADF8\uAC00 \uC804\uC1A1\uB418\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.",...t);return}let g="",a={},p={};t.length>0&&(typeof t[0]=="string"?(g=t[0],t.length>1&&typeof t[1]=="object"&&t[1]!==null?!i&&!n&&!r&&(a={...t[1]}):t.length>1&&(g+=" "+t.slice(1).map(h=>typeof h=="object"?JSON.stringify(h):String(h)).join(" "))):g=t.map(h=>typeof h=="object"?JSON.stringify(h):String(h)).join(" "));let f;i?f="error":n?f="network":r?f="event":f="general",i&&(p.error=i),n&&(p.http=n),c&&(p.client=c),r&&(p.event=r);let b=this.logSequenceCounter++,d={timestamp:new Date().toISOString(),sequence:b,level:e.toUpperCase(),message:g,source:"frontend",projectKey:this.apiKey,environment:this.environment,requestId:u.getCurrentRequestId(),logger:o,logType:f,...p};Object.keys(a).length>0&&(d.payload=a),typeof window<"u"&&typeof navigator<"u"&&typeof location<"u"&&(d.client||(d.client={}),d.client.url=d.client.url||window.location.href,d.client.userAgent=d.client.userAgent||navigator.userAgent,document.referrer&&!d.client.referrer&&(d.client.referrer=document.referrer));try{let h=new Blob([JSON.stringify(d)]).size;this.logQueue.push(d),this.currentQueueSize+=h,this.currentQueueSize>=this.maxQueueSize?this.sendBatch():this.scheduleBatch()}catch(h){this.originalConsole?.error?.("[CHO:LOG] \uB85C\uADF8 \uD06C\uAE30 \uACC4\uC0B0 \uC911 \uC624\uB958 \uBC1C\uC0DD, \uAC1C\uC218 \uAE30\uBC18 \uB300\uAE30\uC5F4\uB85C \uC804\uD658\uD569\uB2C8\uB2E4.",h),this.logQueue.push(d),this.logQueue.length>20?this.sendBatch():this.scheduleBatch()}}static scheduleBatch(){this.batchTimeoutId===null&&this.logQueue.length>0&&(this.batchTimeoutId=window.setTimeout(async()=>{this.batchTimeoutId=null,await this.sendBatch(),this.logQueue.length>0&&this.scheduleBatch()},this.batchInterval))}static async sendBatch(){if(this.logQueue.length===0)return;this.batchTimeoutId!==null&&(clearTimeout(this.batchTimeoutId),this.batchTimeoutId=null);let e=[...this.logQueue];this.logQueue=[],this.currentQueueSize=0;try{let o=await fetch(this.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json","App-Key":this.apiKey},body:JSON.stringify(e)});if(!o.ok){let t=await o.text();throw new Error(`Log send failed: ${o.status} - ${t}`)}}catch(o){this.originalConsole?this.originalConsole.error("[CHO:LOG] \uB85C\uAC70 \uBC30\uCE58 \uC804\uC1A1 \uC624\uB958:",o):console.error("[CHO:LOG] \uB85C\uAC70 \uBC30\uCE58 \uC804\uC1A1 \uC624\uB958 (\uC6D0\uBCF8 \uCF58\uC194 \uC0AC\uC6A9 \uBD88\uAC00):",o)}}static log(e,o){this.prepareAndQueueLog("info","cholog",[e,o||{}])}static info(e,o){this.prepareAndQueueLog("info","cholog",[e,o||{}])}static warn(e,o){this.prepareAndQueueLog("warn","cholog",[e,o||{}])}static error(e,o){this.prepareAndQueueLog("error","cholog",[e,o||{}])}static debug(e,o){this.prepareAndQueueLog("debug","cholog",[e,o||{}])}static trace(e,o){this.prepareAndQueueLog("trace","cholog",[e,o||{}])}static logError(e,o,t){this.prepareAndQueueLog("error","cholog",[e],o,void 0,t)}static logHttp(e,o,t,i){let n=i||o.httpStatus&&o.httpStatus>=400?"error":"info";this.prepareAndQueueLog(n,"cholog",[e],i,o,t)}static logEvent(e,o,t){this.prepareAndQueueLog("info","cholog",[e],void 0,void 0,t,o)}};var m=class s{static{this.isInitialized=!1}static{this.originalFetch=null}static{this.originalXhrOpen=null}static{this.originalXhrSend=null}static patchFetch(){typeof window>"u"||!window.fetch||(this.originalFetch=window.fetch,window.fetch=async(e,o)=>{let t=typeof e=="string"?e:e instanceof URL?e.href:e.url;if(t.startsWith(l.getApiEndpoint()))return s.originalFetch.call(window,e,o);let i=u.getCurrentRequestId()||u.startNewRequest(),n={...o||{}};n.headers=new Headers(n.headers),n.headers.has("X-Request-ID")||n.headers.set("X-Request-ID",i);let c=Date.now(),r={requestMethod:(n.method||(typeof e!="string"&&!(e instanceof URL)?e.method:"GET")||"GET").toUpperCase(),requestUri:t};try{let g=await s.originalFetch.call(window,e,n),a=Date.now()-c;return l.logHttp(`Fetch \uC694\uCCAD => ${r.requestMethod} ${r.requestUri} - \uC0C1\uD0DC => ${g.status}`,{...r,httpStatus:g.status,responseTime:a},void 0),g}catch(g){let a=Date.now()-c,p={type:g?.name||"FetchError",message:g?.message||"Network request failed",stacktrace:g?.stack};throw l.logHttp(`Fetch \uC624\uB958 => ${r.requestMethod} ${r.requestUri}`,{...r,responseTime:a},void 0,p),g}})}static patchXMLHttpRequest(){if(typeof window>"u"||!window.XMLHttpRequest)return;this.originalXhrOpen=XMLHttpRequest.prototype.open,this.originalXhrSend=XMLHttpRequest.prototype.send;let e=this;XMLHttpRequest.prototype.open=function(o,t){this._chologMethod=o,this._chologUrl=typeof t=="string"?t:t.toString(),this._chologUrl.startsWith(l.getApiEndpoint())&&(this._chologSkip=!0),e.originalXhrOpen.apply(this,arguments)},XMLHttpRequest.prototype.send=function(o){if(this._chologSkip)return e.originalXhrSend.apply(this,arguments);let t=this;t._chologStartTime=Date.now();let i=u.getCurrentRequestId()||u.startNewRequest();this.setRequestHeader("X-Request-ID",i);let n={requestMethod:(t._chologMethod||"UnknownMethod").toUpperCase(),requestUri:t._chologUrl||"UnknownURL"},c=()=>{if(t._chologLogged)return;t._chologLogged=!0;let r=t._chologStartTime?Date.now()-t._chologStartTime:void 0,g;(t.status===0||t.status>=400)&&(g={type:t.statusText||"XHRError",message:`XHR \uC624\uB958 => ${n.requestUri} - \uC0C1\uD0DC => ${t.status||"N/A"}. ReadyState: ${t.readyState}`}),l.logHttp(`XHR \uC694\uCCAD => ${n.requestMethod} ${n.requestUri} - \uC0C1\uD0DC => ${t.status}`,{...n,httpStatus:t.status,responseTime:r},void 0,g),t.removeEventListener("loadend",c)};t.addEventListener("loadend",c),e.originalXhrSend.apply(this,arguments)}}static init(){if(!this.isInitialized)try{this.patchFetch(),this.patchXMLHttpRequest(),this.isInitialized=!0}catch(e){console.error("[CHO:LOG] SDK: NetworkInterceptor \uCD08\uAE30\uD654\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.",e)}}};var L=class{static{this.isInitialized=!1}static{this.handleGlobalError=(e,o,t,i,n)=>{let c="\uCC98\uB9AC\uB418\uC9C0 \uC54A\uC740 \uC804\uC5ED \uC624\uB958",r={type:"UnknownError",message:""},g={},a=n;if(e instanceof ErrorEvent&&e.error?(a=e.error,c=e.message||a?.message||"\uC624\uB958 \uBA54\uC2DC\uC9C0\uB97C \uC0AC\uC6A9\uD560 \uC218 \uC5C6\uC74C",r.type=a?.name||"ErrorEvent",r.message=a?.message||c,a?.stack&&(r.stacktrace=a.stack)):typeof e=="string"?(c=e,r.message=e,a?(r.type=a.name,a.stack&&(r.stacktrace=a.stack)):(r.type="GenericError",o&&(r.message+=` in ${o}`))):a&&(c=a.message,r.type=a.name,r.message=a.message,a.stack&&(r.stacktrace=a.stack)),r.stacktrace?.includes("cholog")||c?.includes("Cholog SDK")){console.warn("[CHO:LOG] SDK \uB0B4\uBD80\uC5D0\uC11C \uBC1C\uC0DD\uD55C \uC7A0\uC7AC\uC801 \uC7AC\uADC0 \uC624\uB958\uB97C \uCC28\uB2E8\uD588\uC2B5\uB2C8\uB2E4.",c);return}typeof window<"u"&&(g.url=window.location.href),l.logError(c,r,g)}}static{this.handleUnhandledRejection=e=>{let o=e.reason,t="\uCC98\uB9AC\uB418\uC9C0 \uC54A\uC740 \uD504\uB85C\uBBF8\uC2A4 \uAC70\uBD80",i={type:"UnhandledRejection",message:""},n={};if(o instanceof Error)t=o.message||"\uD504\uB85C\uBBF8\uC2A4\uAC00 \uC624\uB958\uC640 \uD568\uAED8 \uAC70\uBD80\uB428",i.type=o.name||"UnhandledRejectionError",i.message=o.message,o.stack&&(i.stacktrace=o.stack);else{try{i.message=`\uC6D0\uC778: ${JSON.stringify(o)}`}catch{i.message="\uC6D0\uC778: [\uC9C1\uB82C\uD654 \uBD88\uAC00\uB2A5]"}t=`Unhandled promise rejection: ${i.message}`}if(i.stacktrace?.includes("cholog")||t?.includes("Cholog SDK")){console.warn("[CHO:LOG] SDK \uB0B4\uBD80\uC5D0\uC11C \uBC1C\uC0DD\uD55C \uC7A0\uC7AC\uC801 \uC7AC\uADC0 \uC624\uB958\uB97C \uCC28\uB2E8\uD588\uC2B5\uB2C8\uB2E4.",t);return}typeof window<"u"&&(n.url=window.location.href),l.logError(t,i,n)}}static init(){if(!(this.isInitialized||typeof window>"u"))try{window.onerror=this.handleGlobalError,window.addEventListener("unhandledrejection",this.handleUnhandledRejection),this.isInitialized=!0}catch(e){console.error("[CHO:LOG] SDK: ErrorCatcher \uCD08\uAE30\uD654\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.",e)}}};var y=class{static{this.config={significantElementSelector:'button, a, [role="button"], input[type="submit"], [data-cholog-action]'}}static init(e){typeof window>"u"||(e?.significantElementSelector&&(this.config.significantElementSelector=e.significantElementSelector),this.logNavigation(window.location.href,"initial_load"),window.addEventListener("hashchange",()=>this.logNavigation(window.location.href,"hash_change")),window.addEventListener("popstate",()=>this.logNavigation(window.location.href,"popstate_navigation")),document.addEventListener("click",o=>{let i=o.target.closest(this.config.significantElementSelector);if(i){u.startNewRequest();let n={type:"user_interaction_click",targetSelector:this.getElementPath(i),properties:{elementType:i.tagName.toLowerCase(),elementId:i.id||void 0,elementClasses:i.className||void 0}};l.logEvent(`\uD074\uB9AD \uC774\uBCA4\uD2B8 => ${n.targetSelector}`,n)}},!0))}static logNavigation(e,o){u.startNewRequest();let t={type:o,properties:{currentUrl:e}};l.logEvent(`\uB124\uBE44\uAC8C\uC774\uC158 \uC774\uBCA4\uD2B8 => ${o} to ${e}`,t)}static getElementPath(e){let o=[],t=e;for(;t&&t.tagName;){let i=t.tagName.toLowerCase();if(t.id){i+=`#${t.id}`,o.unshift(i);break}else t.classList&&t.classList.length>0&&(i+=`.${Array.from(t.classList).join(".")}`);if(o.unshift(i),t===document.body||o.length>=7)break;t=t.parentElement}return o.join(" > ")}};var w={init:s=>{u.startNewRequest();let{apiKey:e,environment:o,enableEventTracker:t=!0,enableErrorCatcher:i=!0,enableNetworkInterceptor:n=!0,loggerOptions:c}=s;l.init({apiKey:e,environment:o,...c||{}}),n&&m.init(),i&&L.init(),t&&y.init();let r=o||"default (by Logger)";l.info("Cholog SDK Initialized",{sdk:"cholog-sdk",version:"1.0.7",features:{eventTracker:t,errorCatcher:i,networkInterceptor:n},configApplied:{projectKeyObfuscated:e?`${e.substring(0,3)}...`:"NOT_SET",environment:r,batchInterval:c?.batchInterval||"default (Logger)",maxQueueSize:c?.maxQueueSize||"default (Logger)"}})},log:(s,e)=>l.log(s,e),info:(s,e)=>l.info(s,e),warn:(s,e)=>l.warn(s,e),error:(s,e)=>{l.error(s,e)},debug:(s,e)=>l.debug(s,e),trace:(s,e)=>l.trace(s,e)},k=w;return R(T);})();
